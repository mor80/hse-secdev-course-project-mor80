# Wishlist — сервис желаемых вещей

Учебный проект курса **HSE SecDev 2025**.
Задача — спроектировать и реализовать веб-сервис с безопасной архитектурой, валидацией данных, тестами и CI/CD.

---

## Цели проекта
- Освоить базовые практики **безопасной разработки** (валидация, owner-only доступ, секреты вне кода).
- Настроить **гигиену репозитория** (pre-commit, линтеры, CI).
- Реализовать минимальный **MVP сервиса**:
  - хранение «желаний» пользователя (CRUD),
  - аутентификация и разграничение прав,
  - фильтры, сортировки, экспорт,
  - корректная обработка ошибок.

---

## Быстрый старт
```bash
python -m venv .venv
source .venv/bin/activate  # Windows: .venv\Scripts\Activate.ps1
pip install -r requirements.txt -r requirements-dev.txt
pre-commit install
uvicorn app.main:app --reload
```

---

## Ритуал перед PR
```bash
ruff check --fix .
black .
isort .
pytest -q
pre-commit run --all-files
```

---

## Тесты
```bash
pytest -q
```

---

## CI
В репозитории настроен workflow **CI** (GitHub Actions) — required check для `main`.
Badge добавится автоматически после загрузки шаблона в GitHub.

---

## Контейнеры
```bash
docker build -t secdev-app .
docker run --rm -p 8000:8000 secdev-app
# или
docker compose up --build
```

---

## Эндпойнты
- `GET /health` → `{"status": "ok"}`
- `POST /wishes?name=...` — создать сущность
- `GET /wishes/{id}` — получить по id
- `GET /wishes` — список с фильтрами
- `PATCH /wishes/{id}` — обновить
- `DELETE /wishes/{id}` — удалить
- `GET /wishes/export.csv` — экспорт в CSV

---

## Формат ошибок
Все ошибки — JSON-обёртка:
```json
{
  "error": {"code": "not_found", "message": "item not found"}
}
```

---

## Требования Безопасности

| Категория          | Требование                                                                | Как реализовано |
|--------------------|---------------------------------------------------------------------------|-----------------|
| Аутентификация     | Минимальная длина пароля — 6 символов.                                    | В схеме регистрации проверка через `pydantic.Field(min_length=6)`. |
| Сессии             | Время жизни access-токена не более 15 минут, refresh-токена — до 30 минут; поддерживается завершение сессии. | Конфиги: `ACCESS_TOKEN_EXPIRE_MINUTES=15`, `REFRESH_TOKEN_EXPIRE_MINUTES=30`; при logout токены аннулируются. |
| Ошибки/ответы      | Сообщения об ошибках единообразные; код возврата 401 или 403 без уточнений. | Все исключения маппятся на `HTTPException` с единым JSON-ответом. |
| Секреты            | Ключи и пароли не хранятся в коде, только в переменных окружения.          | Используются `.env` и GitHub Secrets, pre-commit следит за отсутствием ключей. |
| Логи и аудит       | Фиксируются все HTTP-запросы и действия с сущностями (создание, удаление, экспорт). | Uvicorn пишет access-логи, дополнительно пишем audit-события CRUD. |
| Приватность/данные | В БД остаётся только необходимая информация (title, link, price, notes, category, owner_id). | Модели минимальны, чувствительные данные не собираются, удалённые записи стираются окончательно. |


См. также: `SECURITY.md`, `.pre-commit-config.yaml`, `.github/workflows/ci.yml`.
